<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.isolatingdomainsample.infrastructure.datasource.employee.EmployeeMapper">

    <sql id="selectEmployee">
        SELECT
        従業員.従業員ID as "employeeNumber.value",
        従業員の名前.従業員名 as "name.value",
        従業員のメールアドレス.メールアドレス as "mailAddress.value",
        従業員の電話番号.電話番号 as "phoneNumber.value"
        FROM 給与.従業員 as 従業員
        INNER JOIN 給与.従業員の名前 as 従業員の名前 on (
        従業員.従業員ID = 従業員の名前.従業員ID
        ) INNER JOIN 給与.従業員の電話番号 as 従業員の電話番号 on (
        従業員.従業員ID = 従業員の電話番号.従業員ID
        ) INNER JOIN 給与.従業員のメールアドレス as 従業員のメールアドレス on (
        従業員.従業員ID = 従業員のメールアドレス.従業員ID
        ) INNER JOIN 給与.契約中 as 契約中 on (
        従業員.従業員ID = 契約中.従業員ID
        )
    </sql>

    <select id="selectByEmployeeNumber" resultType="com.example.isolatingdomainsample.domain.model.employee.Employee">
        <include refid="selectEmployee"></include>
        WHERE 従業員.従業員ID = #{employeeNumber.value}
    </select>

    <select id="selectContracts" resultType="com.example.isolatingdomainsample.domain.model.employee.Employee">
        <include refid="selectEmployee" />
        ORDER BY 従業員.従業員ID;
    </select>

    <delete id="deleteInspireContract">
        DELETE FROM 給与.契約中 WHERE 従業員ID = #{employeeNumber.value}
    </delete>

    <insert id="insertExpireContract">
        INSERT INTO 給与.契約終了 (従業員ID) VALUES (#{employeeNumber.value});
    </insert>
    
</mapper>
